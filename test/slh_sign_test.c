#include "unity.h"
#include "slh_sign.h"

char m[SLH_PARAM_n] = "abcdefghijklmnopqrstuvwxyz123456";

char pk_seed[PK_SEED_BYTES] = {
    0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10,
    0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10,
    0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10,
    0xfe, 0xdc, 0xba, 0x98, 0x76, 0x54, 0x32, 0x10
};

char sk_seed[SK_SEED_BYTES] = {
    0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef,
    0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef,
    0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef,
    0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef
};


void setUp(void) {
    // set stuff up here
}

void tearDown(void) {
    // clean stuff up here
}

void test_function_wots_sign() {
    ADRS adrs = {0};
    // setLayerAddress(&adrs, 1);
    // setTreeAddress(&adrs, 1);
    // setTypeAndClear(&adrs, 5);
    // setKeyPairAddress(&adrs, 2);
    // setChainAddress(&adrs, 3);
    // setHashAddress(&adrs, 0);    

    char signature[SLH_PARAM_len * SLH_PARAM_n];

    char pk_zeros[SLH_PARAM_n] = {0};
    char sk_zeros[SLH_PARAM_n] = {0};

    wots_sign(m, sk_zeros, pk_zeros, &adrs, signature);

    const unsigned char expected[32] = {
        0xa3, 0x8d, 0x7c, 0x2c, 0x85, 0xdc, 0x51, 0x89,
        0xa8, 0xc6, 0xf1, 0x5f, 0x34, 0x49, 0xdc, 0xa3,
        0xaf, 0xdf, 0xbd, 0xfd, 0x98, 0xf8, 0xa5, 0x14,
        0x47, 0xb2, 0x11, 0xca, 0xf0, 0xcb, 0x6a, 0x63
    };
    
    TEST_ASSERT_EQUAL_HEX8_ARRAY(expected, signature, SLH_PARAM_n);
}

void test_function_fors_node() {
    ADRS adrs = {0};  

    char leaf_node[SLH_PARAM_n * 2];
    char intermediate_node[SLH_PARAM_n * 2];

    const unsigned char expected_leaf[SLH_PARAM_n] = {
        0xca, 0x3f, 0x21, 0x41, 0x22, 0x3e, 0x96, 0x16,
        0x00, 0x62, 0xe1, 0xa9, 0xf6, 0xf4, 0x68, 0x35,
        0x17, 0x3c, 0x04, 0x19, 0x13, 0x6d, 0xef, 0x68,
        0xee, 0x7b, 0x5c, 0x30, 0x32, 0x3e, 0xc8, 0xcc
    };    

    const unsigned char expected_intermediate[SLH_PARAM_n] = {
        0xb0, 0x42, 0x7f, 0xfb, 0xd6, 0x47, 0x24, 0x5f,
        0xd7, 0x40, 0xdc, 0xbd, 0x29, 0x8c, 0x11, 0xfe,
        0x08, 0x4a, 0x75, 0x1a, 0x34, 0x15, 0x03, 0x68,
        0xc2, 0x02, 0xfa, 0x68, 0x95, 0x93, 0xf5, 0xf0
    };    
    
    // Test for a leaf node
    fors_node(sk_seed, 0, 0, pk_seed, &adrs, leaf_node);
    TEST_ASSERT_EQUAL_HEX8_ARRAY(expected_leaf, leaf_node, SLH_PARAM_n);

    // Test for an intermediate node
    fors_node(sk_seed, 0, 1, pk_seed, &adrs, intermediate_node);
    TEST_ASSERT_EQUAL_HEX8_ARRAY(expected_intermediate, intermediate_node, SLH_PARAM_n);

}    

int main(void) {
    UNITY_BEGIN();
    RUN_TEST(test_function_wots_sign);
    RUN_TEST(test_function_fors_node);
    
    return UNITY_END();
}
